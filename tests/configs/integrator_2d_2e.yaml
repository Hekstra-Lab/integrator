global_vars:
  encoder_out: &encoder_out 64
  mc_samples: &mc_samples 100
  data_dir: &data "/Users/luis/integrator/tests/data/2d/hewl_1118/"
integrator:
  name: integrator
  args:
    lr: 0.001
    mc_samples: *mc_samples
    renyi_scale: 0.0
    data_dim: "2d"
    encoder_out: *encoder_out
    d: &d 1
    h: &h 21
    w: &w 21
    weight_decay: 0.0
encoders:
  - encoder1:
      name: shoebox_minimal
      args:
        in_channels: 1
        encoder_out: 64
        conv1_out: 16
        conv2_out: 32
        # name: shoebox_encoder
        # data_dim: 3d
        # in_channels: 1
        # input_shape: [*d, *h, *w]
        # encoder_out: *encoder_out
        # conv1_out_channels: 64
        # conv1_kernel_size: [1, 3, 3]
        # conv1_padding: [0, 1, 1]
        # norm1_num_groups: 4
        # pool_kernel_size: [1, 2, 2]
        # pool_stride: [1, 2, 2]
        # conv2_out_channels: 128
        # conv2_kernel_size: [3, 3, 3]
        # conv2_padding: [0, 0, 0]
        # norm2_num_groups: 4
  - encoder2:
      name: intensity_encoder_minimal
      args:
        in_channels: 1
        encoder_out: 64
        conv1_out: 16
        conv2_out: 32
        # name: intensity_minimal
        # args:
        #   data_dim: 3d
        #   in_channels: 1
        #   encoder_out: *encoder_out
        #   conv1_out_channels: 64
        #   conv1_kernel_size: [3, 3, 3]
        #   conv1_padding: [1, 1, 1]
        #   norm1_num_groups: 4
        #   pool_kernel_size: [1, 2, 2]
        #   pool_stride: [1, 2, 2]
        #   conv2_out_channels: 128
        #   conv2_kernel_size: [3, 3, 3]
        #   conv2_padding: [0, 0, 0]
        #   norm2_num_groups: 4
        #   conv3_out_channels: 256
        #   conv3_kernel_size: [3, 3, 3]
        #   conv3_padding: [1, 1, 1]
        #   norm3_num_groups: 8
  - encoder3:
      name: mlp_metadata_encoder
      args:
        encoder_in: 4 #number of features
        encoder_out: *encoder_out
surrogates:
  qp:
    name: dirichlet
    args:
      in_features: *encoder_out
      out_features: [*d, *h, *w]
      constraint: softplus
  qbg:
    name: folded_normal
    args:
      in_features: *encoder_out
      out_features: 2
      constraint: softplus
  qi:
    name: gamma
    args:
      in_features: *encoder_out
      estimand: intensity
      n_images: 999
      # out_features: 2
      # constraint: softplus
loss:
  name: 'loss'
  args:
    mc_smpls: 100
    eps: 0.000001
  priors:
    intensity:
      name: 'gamma'
      params:
        concentration: 1.0
        rate: 0.5
      weight: 0.01
    background:
      name: 'gamma'
      params:
        concentration: 1.0
        rate: 0.5
      weight: 0.5
    profile:
      name: 'dirichlet'
      params:
        concentration: '/Users/luis/integrator/tests/data/2d/hewl_1118/concentration_2d.pt'
      weight: 0.5
data_loader:
  name: shoebox_data_module_2d
  args:
    data_dir: *data
    batch_size: 10
    val_split: 0.3
    test_split: 0.0
    num_workers: 0
    include_test: false
    subset_size: 100
    cutoff: 2000
    use_metadata: true
    shoebox_file_names:
      counts: "counts_2d_subset.pt"
      masks: "masks_2d_subset.pt"
      stats: "stats_2d.pt"
      reference: "reference_2d_subset.pt"
      x_coords: null
      y_coords: null
      standardized_counts: null
    D: 1
    H: 21
    W: 21
    anscombe: true
trainer:
  args:
    max_epochs: 5
    accelerator: auto
    devices: 1
    logger: true
    precision: "32"
    check_val_every_n_epoch: 2
    log_every_n_steps: 1
    deterministic: false
    callbacks:
      pred_writer:
        output_dir: null
        write_interval: epoch
    enable_checkpointing: true
logger:
  d: *d
  h: *h
  w: *w
output:
  refl_file: "/Users/luis/integratorv3/integrator/data/hewl_816/reflections_.refl"

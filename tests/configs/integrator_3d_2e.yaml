global_vars:
  encoder_out: &encoder_out 64
  mc_samples: &mc_samples 100
  data_dir: &data "/Users/luis/integratorv4/tests/data/3d/hewl_9b7c/"
integrator:
  name: integrator
  args:
    lr: 0.001
    mc_samples: *mc_samples
    renyi_scale: 0.0
    data_dim: "3d"
    encoder_out: *encoder_out
    d: &d 3
    h: &h 21
    w: &w 21
    weight_decay: 0.0
components:
  encoders:
    - encoder1:
        name: shoebox_encoder
        args:
          encoder_out: *encoder_out
          in_channels: 1
          conv1_out_channels: 64
          conv2_out_channels: 128
          conv1_kernel_size: [1, 3, 3]
          conv1_padding: [0, 1, 1]
    - encoder2:
        name: intensity_encoder
        args:
          data_dim: 3d
          in_channels: 1
          encoder_out: *encoder_out
          conv1_out_channels: 64
          conv1_kernel_size: [3, 3, 3]
          conv1_padding: [1, 1, 1]
          norm1_num_groups: 4
          pool_kernel_size: [1, 2, 2]
          pool_stride: [1, 2, 2]
          conv2_out_channels: 128
          conv2_kernel_size: [3, 3, 3]
          conv2_padding: [0, 0, 0]
          norm2_num_groups: 4
          conv3_out_channels: 256
          conv3_kernel_size: [3, 3, 3]
          conv3_padding: [1, 1, 1]
          norm3_num_groups: 8
  qp:
    name: dirichlet
    args:
      in_features: *encoder_out
      out_features: [*d, *h, *w]
      constraint: softplus
  qbg:
    name: folded_normal
    args:
      in_features: *encoder_out
      out_features: 2
      constraint: softplus
  qi:
    name: folded_normal
    args:
      in_features: *encoder_out
      out_features: 2
      constraint: softplus
  loss:
    name: loss
    args:
      pi_name: half_normal
      pi_params:
        scale: 0.5
      pbg_name: half_normal
      pbg_params:
        scale: 1.0
      pprf_name: dirichlet
      pprf_params: null
      pprf_weight: 0.0001
      pbg_weight: 0.5
      pi_weight: 1.0
      use_robust: true
      data_dir: *data
      prior_tensor: 'concentration_3d.pt'
data_loader:
  name: default
  args:
    data_dir: *data
    batch_size: 10
    val_split: 0.3
    test_split: 0.0
    num_workers: 0
    include_test: false
    subset_size: 100
    cutoff: 2000
    use_metadata: true
    shoebox_file_names:
      counts: "counts_3d_subset.pt"
      masks: "masks_3d_subset.pt"
      stats: "stats_3d.pt"
      reference: "reference_3d_subset.pt"
      standardized_counts: null
trainer:
  args:
    max_epochs: 600
    accelerator: auto
    devices: 1
    logger: true
    precision: "32"
    check_val_every_n_epoch: 2
    log_every_n_steps: 1
    deterministic: false
    callbacks:
      pred_writer:
        output_dir: null
        write_interval: epoch
    enable_checkpointing: true
logger:
  d: 3
  h: 21
  w: 21
output:
  refl_file: "/Users/luis/integratorv3/integrator/data/hewl_816/reflections_.refl"
